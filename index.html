<!doctype html>
<html lang="en">
<head>
 <meta charset="utf-8"/>
 <meta content="width=device-width,initial-scale=1" name="viewport"/>
 <title>Markdown Preview - input.md</title>
 <!-- Marked (latest) -->
 <script src="https://cdn.jsdelivr.net/npm/marked@latest/marked.min.js"></script>
 <!-- Highlight.js (latest) and a theme -->
 <link href="https://cdn.jsdelivr.net/npm/highlight.js@latest/styles/github.min.css" rel="stylesheet"/>
 <script src="https://cdn.jsdelivr.net/npm/highlight.js@latest/build/highlight.min.js"></script>
 <style>
  :root{
     --bg:#f7f9fb;
     --card:#ffffff;
     --text:#0f1724;
     --muted:#475569;
     --accent:#0366d6;
   }
   html,body{
     height:100%;
     margin:0;
     font-family: Inter, ui-sans-serif, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
     background:linear-gradient(180deg,var(--bg),#ffffff);
     color:var(--text);
     -webkit-font-smoothing:antialiased;
     -moz-osx-font-smoothing:grayscale;
   }
   .wrap{
     max-width:900px;
     margin:36px auto;
     padding:20px;
   }
   header{
     display:flex;
     align-items:flex-start;
     justify-content:space-between;
     gap:12px;
     margin-bottom:18px;
   }
   .logo{
     width:48px;
     height:48px;
     border-radius:8px;
     background:linear-gradient(135deg,var(--accent),#0047b3);
     display:flex;
     align-items:center;
     justify-content:center;
     color:white;
     font-weight:700;
     font-size:20px;
     box-shadow:0 6px 18px rgba(3,102,214,0.18);
   }
   h1{
     font-size:20px;
     margin:0;
   }
   p.lead{
     margin:6px 0 0 0;
     color:var(--muted);
     font-size:13px;
   }
   .card{
     background:var(--card);
     border-radius:12px;
     box-shadow:0 6px 18px rgba(9,30,66,0.06);
     padding:28px;
     min-height:220px;
   }
   #markdown-output{
     max-width:100%;
     font-size:16px;
     line-height:1.65;
   }
   #markdown-output h1,#markdown-output h2,#markdown-output h3{
     margin-top:1.2em;
     margin-bottom:.4em;
     line-height:1.2;
   }
   #markdown-output p{
     margin:.6em 0;
   }
   #markdown-output pre{
     background:#0b1220;
     color:#e6eef6;
     padding:12px;
     border-radius:8px;
     overflow:auto;
     font-size:13px;
     line-height:1.45;
   }
   #markdown-output code{
     background:rgba(27,31,35,0.06);
     padding:.2em .4em;
     border-radius:6px;
     font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, "Roboto Mono", "Segoe UI Mono", "Courier New", monospace;
     font-size:13px;
   }
   pre#markdown-source{
     background:#f6f8fa;
     border:1px solid #e5e7eb;
     border-radius:8px;
     padding:0;
     margin:0;
     overflow:auto;
     max-height: 60vh;
   }
   #markdown-source code{
     display:block;
     white-space:pre-wrap;
     padding:14px 16px;
     font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, "Roboto Mono", "Segoe UI Mono", "Courier New", monospace;
     font-size:13px;
     line-height:1.6;
     color:#111827;
   }
   a { color:var(--accent); text-decoration: none; }
   a:hover { text-decoration:underline; }
   .meta{
     margin-top:12px;
     color:var(--muted);
     font-size:13px;
   }
   .error{
     color:#9b1c1c;
     background:#fff0f0;
     padding:10px;
     border-radius:8px;
     border:1px solid rgba(155,28,28,0.08);
   }
   /* Tabs styling */
   #markdown-tabs{
     display:flex;
     gap:6px;
     align-items:center;
     margin-bottom:12px;
     border-bottom:1px solid #e6e9ef;
   }
   #markdown-tabs button{
     background: transparent;
     border:0;
     padding:10px 14px;
     font-weight:600;
     color:var(--muted);
     cursor:pointer;
     border-bottom:2px solid transparent;
     border-radius:6px 6px 0 0;
   }
   #markdown-tabs button.active{
     color:var(--text);
     background:#fff;
     border-bottom:2px solid var(--accent);
   }
   /* Word count badge styling */
   #markdown-word-count{
     display:inline-block;
     padding:2px 8px;
     border-radius:999px;
     background:#fff;
     border:1px solid #e5e7eb;
     font-weight:600;
     margin-left:6px;
   }
   @media (max-width:640px){
     .wrap{ padding:14px; margin:18px; }
     .card{ padding:18px; }
     header{ flex-direction:column; align-items:flex-start; }
   }
 </style>
</head>
<body>
 <div class="wrap">
  <header>
    <div style="display:flex; align-items:center; gap:12px;">
      <div class="logo" aria-label="Logo">MD</div>
      <div>
        <h1>Markdown Preview - input.md</h1>
        <p class="lead">Convert input.md to HTML using marked and highlight.js for code blocks.</p>
      </div>
    </div>
    <div style="min-width:140px; text-align:right;">
      Word count:&nbsp;<span id="markdown-word-count" aria-label="word count">0</span>
    </div>
  </header>

  <div class="card" aria-label="markdown preview card">
    <div id="markdown-tabs" aria-label="view mode">
      <button class="active" data-mode="preview" aria-pressed="true">Preview</button>
      <button data-mode="source" aria-pressed="false">Source</button>
    </div>

    <div id="markdown-area" style="min-height:220px;">
      <div id="markdown-preview" style="display:block;">
        <div id="markdown-output"></div>
      </div>

      <pre id="markdown-source" style="display:none;">
        <code></code>
      </pre>
    </div>

    <div class="meta" id="markdown-meta" aria-label="rendered info">
      Rendered: <span id="markdown-rendered-at"></span>
      <span style="margin-left:12px;">Words: <span id="markdown-word-count-2">0</span></span>
    </div>
  </div>
 </div>

 <script>
  // Initialize libraries and render on load
  document.addEventListener('DOMContentLoaded', () => {
    // Tab switching logic
    const tabs = document.querySelectorAll('#markdown-tabs button');
    const previewPane = document.getElementById('markdown-preview');
    const sourcePane = document.getElementById('markdown-source');
    tabs.forEach(btn => {
      btn.addEventListener('click', () => {
        tabs.forEach(b => b.classList.remove('active'));
        btn.classList.add('active');
        const mode = btn.dataset.mode;
        if (mode === 'preview') {
          previewPane.style.display = '';
          sourcePane.style.display = 'none';
        } else {
          previewPane.style.display = 'none';
          sourcePane.style.display = '';
        }
      });
    });

    // Render the markdown initially
    renderMarkdown();
  });

  async function renderMarkdown() {
    try {
      // Fetch the attachment input.md
      let md = '';
      try {
        const res = await fetch('input.md');
        if (res.ok) {
          md = await res.text();
        } else {
          md = `# Attachment not accessible\nCould not fetch input.md (status: ${res.status}).`;
        }
      } catch (e) {
        md = `# Attachment not accessible\nCould not fetch input.md.`;
      }

      // Word count using Intl.NumberFormat
      const wordCount = countWords(md);
      const nf = new Intl.NumberFormat();
      const wc1 = document.getElementById('markdown-word-count');
      const wc2 = document.getElementById('markdown-word-count-2');
      if (wc1) wc1.textContent = nf.format(wordCount);
      if (wc2) wc2.textContent = nf.format(wordCount);

      // Render markdown to HTML using marked (do not call marked() if present)
      const html = marked.parse(md);
      const output = document.getElementById('markdown-output');
      output.innerHTML = html;

      // Highlight code blocks
      if (typeof hljs !== 'undefined') {
        document.querySelectorAll('#markdown-output pre code').forEach((block) => {
          hljs.highlightElement(block);
        });
      }

      // Show the source in the pre block
      const codeBlock = document.querySelector('#markdown-source code');
      if (codeBlock) codeBlock.textContent = md;

      // Update rendered timestamp
      const renderedAt = document.getElementById('markdown-rendered-at');
      if (renderedAt) {
        const now = new Date().toLocaleString();
        renderedAt.textContent = now;
      }

    } catch (err) {
      const output = document.getElementById('markdown-output');
      if (output) {
        output.innerHTML = `<div class="error">Failed to render markdown: ${err?.message ?? err}</div>`;
      }
    }
  }

  function countWords(text) {
    const t = (text ?? '');
    const trimmed = t.trim();
    if (!trimmed) return 0;
    // Count words by whitespace separation
    return trimmed.split(/\s+/).filter(Boolean).length;
  }
 </script>
</body>
</html>